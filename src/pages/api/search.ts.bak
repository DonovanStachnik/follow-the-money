import type { NextApiRequest, NextApiResponse } from "next";
import { getQuote, getExpirations } from "../../utils/yahoo";

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const ticker = String(req.query.ticker || "").toUpperCase().trim();
  if (!ticker) return res.status(200).json({ error: "Missing ticker" });
  try {
    const q = await getQuote(ticker);
    const expirations = await getExpirations(ticker);
    return res.status(200).json({
      quote: { symbol: q.symbol, longName: q.longName, regularMarketPrice: q.price },
      expirations
    });
  } catch (e:any) {
    return res.status(200).json({ error: e?.message || "SEARCH_FAIL" });
  }
}
